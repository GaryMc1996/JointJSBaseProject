var causalEvidence =
        [
            {
                "fromNode": {
                    "DAPSIWR": "Pressure",
                    "_label": "SyntheticCompounds",
                    "className": "Synthetic Compounds",
                    "name": "Contamination by Synthetic Compounds",
                    "_id": "#957:0"
                },
                "toNode": {
                    "DAPSIWR": "State",
                    "_label": "FishPopulations",
                    "className": "Fish Populations",
                    "name": "Fish Populations",
                    "_id": "#1041:0"
                },
                "evidence": [
                    {
                        "knowledge": {
                            "_id": "#2281:6",
                            "_label": "ShortFilmFiction",
                            "className": "Short Film Fiction",
                            "kGroup": "Film",
                            "knowledgeId": "12MLP_9876",
                            "title": "12Review of Microplastics in Cosmetics",
                            "author": "Lesley, H.A.",
                            "publisher": "IVM Institute for Environmental Studies",
                            "pubYear": 2016,
                            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
                            "rating": 2
                        },
                        "relevance": 80
                    }
                ]
            },
            {
                "fromNode": {
                    "DAPSIWR": "State",
                    "_label": "FishPopulations",
                    "className": "Fish Populations",
                    "name": "Fish Populations",
                    "_id": "#1041:0"
                },
                "toNode": {
                    "DAPSIWR": "Impact",
                    "_label": "Impact",
                    "className": "Impact",
                    "name": "Impact",
                    "_id": "#1109:0"
                },
                "evidence": [
                    {
                        "knowledge": {
                            "_id": "#2282:5",
                            "_label": "ShortFilmFiction",
                            "className": "Short Film Fiction",
                            "kGroup": "Film",
                            "knowledgeId": "122MLP_9876",
                            "title": "122Review of Microplastics in Cosmetics",
                            "author": "Lesley, H.A.",
                            "publisher": "IVM Institute for Environmental Studies",
                            "pubYear": 2016,
                            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
                            "rating": 2
                        },
                        "relevance": 90
                    }
                ]
            },
            {
                "fromNode": {
                    "DAPSIWR": "Pressure",
                    "_label": "SyntheticCompounds",
                    "className": "Synthetic Compounds",
                    "name": "Contamination by Synthetic Compounds",
                    "_id": "#957:0"

                },
                "toNode": {
                    "DAPSIWR": "State",
                    "_label": "Zooplankton",
                    "className": "Zooplankton Communities",
                    "name": "Zooplankton",
                    "_id": "#1069:0"

                },
                "evidence": [
                    {
                        "knowledge": {
                            "_id": "#2209:0",
                            "_label": "Flyer",
                            "className": "Flyer",
                            "kGroup": "Non Academic Press",
                            "knowledgeId": "MPL_2345",
                            "title": "Microplastics Polluting our Seas",
                            "author": "Marijana Tobin, Nadja Ziebarth",
                            "publisher": "Coalition Clean Baltic (CCB)",
                            "pubYear": 2015,
                            "description": "Not available",
                            "rating": 6

                        },
                        "relevance": 100

                    },
                    {
                        "knowledge": {
                            "_id": "#2141:0",
                            "_label": "FlashMob",
                            "className": "Flash Mob",
                            "kGroup": "Visual and Performance Arts",
                            "knowledgeId": "7MPL_2471",
                            "title": "7Review of Microplastics in Cosmetics",
                            "author": "Lesley, H.A.",
                            "publisher": "None specified",
                            "pubYear": 2016,
                            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
                            "rating": 7

                        },
                        "relevance": 60

                    }

                ]

            },
            {
                "fromNode": {
                    "DAPSIWR": "Activity",
                    "_label": "ConsumptionHousehold",
                    "className": "Consumption and Household",
                    "name": " Use of cosmetic products ",
                    "_id": "#261:3"

                },
                "toNode": {
                    "DAPSIWR": "Activity",
                    "_label": "Sewerage",
                    "className": "Sewerage",
                    "name": "Microplastics enter the sewerage system",
                    "_id": "#441:3"

                },
                "evidence": [
                    {
                        "knowledge": {
                            "_id": "#2282:31",
                            "_label": "ShortFilmFiction",
                            "className": "Short Film Fiction",
                            "kGroup": "Film",
                            "knowledgeId": "MPL_2469",
                            "title": "ANOTHER Review of Microplastics in Cosmetics",
                            "author": "Lesley, H.A.",
                            "publisher": "IVM Institute for Environmental Studies",
                            "pubYear": 2016,
                            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
                            "rating": 4

                        },
                        "relevance": 60

                    }

                ]

            },
            {
                "fromNode": {
                    "DAPSIWR": "Activity",
                    "_label": "Sewerage",
                    "className": "Sewerage",
                    "name": "Microplastics enter the sewerage system",
                    "_id": "#441:3"

                },
                "toNode": {
                    "DAPSIWR": "Pressure",
                    "_label": "SyntheticCompounds",
                    "className": "Synthetic Compounds",
                    "name": "Contamination by Synthetic Compounds",
                    "_id": "#957:3"

                },
                "evidence": []

            },
            {
                "fromNode": {
                    "DAPSIWR": "Pressure",
                    "_label": "SyntheticCompounds",
                    "className": "Synthetic Compounds",
                    "name": "Contamination by Synthetic Compounds",
                    "_id": "#957:3"

                },
                "toNode": {
                    "DAPSIWR": "State",
                    "_label": "Seabirds",
                    "className": "Seabirds",
                    "name": "Seabirds",
                    "_id": "#1053:3"

                },
                "evidence": [
                    {
                        "knowledge": {
                            "_id": "#2329:3",
                            "_label": "WebVideo",
                            "className": "Web Video",
                            "kGroup": "Online Digital Media",
                            "knowledgeId": "MLT_3456",
                            "title": "Solutions to marine litter in the EU",
                            "author": "Unspecified",
                            "publisher": "mediomix.com",
                            "pubYear": 2013,
                            "description": "Not available",
                            "rating": 4

                        },
                        "relevance": 50

                    },
                    {
                        "knowledge": {
                            "_id": "#2281:33",
                            "_label": "ShortFilmFiction",
                            "className": "Short Film Fiction",
                            "kGroup": "Film",
                            "knowledgeId": "MPL_2468",
                            "title": "INSERTED Review of Microplastics in Cosmetics",
                            "author": "Lesley, H.A.",
                            "publisher": "IVM Institute for Environmental Studies",
                            "pubYear": 2016,
                            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
                            "rating": 3

                        },
                        "relevance": 80

                    }

                ]

            }

        ];

var smallJSONData = {
    "mode": "NORMAL",
    "vertices": [{
            "xcoord": -920,
            "scope": "Limited to microplastics from cosmetics, not from other sources such as deterioration of larger plastics or discharge from factories or shipping etc.",
            "name": "TEST Microplastics and cosmetics in the EU",
            "topic": "Microplastics",
            "description": "How do microplastics get into the marine environment and what harm do they do?",
            "synopsis": "Investigating the causes and effects of microplastics in the marine environment, and evaluating effectiveness of various responses to reduce this form of marine pollution.",
            "region": "EU",
            "definitions": "Microplastics are defined here as particles of less than 5mm in size.",
            "ycoord": -880,
            "_id": "#17:0",
            "_type": "vertex",
            "_label": "Story",
            "category": "Story"
        },
        {
            "xcoord": -780,
            "name": "Consumption Pattern",
            "description": "More and more personal care and cosmetic products contain microplastics",
            "ycoord": -650,
            "_id": "#93:0",
            "_type": "vertex",
            "_label": "ConsumptionPatterns",
            "category": "Driver"
        },
        {
            "note": "",
            "name": "Driver11",
            "weight": 0.1,
            "description": "drives",
            "_id": "#2377:0",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -450,
            "name": "Manufacture of Soap and Detergents, Cleaning and Polishing Preparations, Perfumes and Toilet Preparations",
            "description": "Manufacture of personal care and cosmetic products containing microplastics",
            "ycoord": -620,
            "_id": "#673:0",
            "_type": "vertex",
            "_label": "SoapPolishPerfumes",
            "category": "Activity"
        },
        {
            "note": "",
            "name": "ValueChain11",
            "weight": 0.4,
            "description": "microplastics flow",
            "_id": "#2380:0",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -260,
            "name": "Sale of cosmetic products",
            "description": "Sale of cosmetic products containing microplastics by retailer",
            "ycoord": -700,
            "_id": "#469:0",
            "_type": "vertex",
            "_label": "Retail",
            "category": "Activity"
        },
        {
            "note": "",
            "name": "ValueChain12",
            "weight": 0.5,
            "description": "microplastics flow",
            "_id": "#2377:1",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -30,
            "name": " Use of cosmetic products ",
            "description": "Use of cosmetic products containing microplastics by consumer",
            "ycoord": -700,
            "_id": "#261:0",
            "_type": "vertex",
            "_label": "ConsumptionHousehold",
            "category": "Activity"
        },
        {
            "note": "",
            "name": "ValueChain13",
            "weight": 0.6,
            "description": "microplastics flow",
            "_id": "#2378:1",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 130,
            "name": "Microplastics enter the sewerage system",
            "description": "Microplastics enter the sewerage system via domestic waste water",
            "ycoord": -560,
            "_id": "#441:0",
            "_type": "vertex",
            "_label": "Sewerage",
            "category": "Activity"
        },
        {
            "xcoord": 250,
            "name": "Citizen",
            "description": "Citizen in the role of householder",
            "ycoord": -680,
            "_id": "#1949:0",
            "_type": "vertex",
            "_label": "Citizen",
            "category": "Actor"
        },
        {
            "note": "",
            "name": "Activity11",
            "weight": 0.7,
            "description": "contributes to",
            "_id": "#2379:1",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 160,
            "name": "Contamination by Synthetic Compounds",
            "description": "Microplastics Released into the Sea via Sewerage",
            "ycoord": -370,
            "_id": "#957:0",
            "_type": "vertex",
            "_label": "SyntheticCompounds",
            "category": "Pressure"
        },
        {
            "note": "",
            "name": "Pressure11",
            "weight": 0,
            "description": "causes state change",
            "_id": "#2380:1",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "name": "Flyer",
            "timeRefFrom": 2014,
            "mainSource": "Google search",
            "geogFocus": "Global",
            "rating": 6,
            "description": "Not available",
            "retrievals": 1009,
            "language": "English, Estonian, Swedish, Belarusian, Russian, Finnish, Latvian, Lithuanian, Polish",
            "title": "Microplastics Polluting our Seas",
            "knowledgeId": "MPL_2345",
            "timeRefTo": 2014,
            "xcoord": 70,
            "commPurpose": "raise awareness",
            "resourceURL": "http:\/\/www.ccb.se\/evidence2015\/Mikroplastikccb-eng.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Microplastics Polluting our Seas",
            "likes": 2000,
            "participants": 150,
            "keyWords": "microplastics, marine environment, global assessment",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Marijana Tobin, Nadja Ziebarth",
            "hits": 99,
            "searchString": "Another search string here",
            "pubYear": 2015,
            "countryOrigin": "Sweden",
            "searchResultsPosition": 3,
            "ycoord": -270,
            "commPractice": "one to many, many to many",
            "pubName": "Coalition Clean Baltic (CCB)",
            "pubOrgType": "Local NGOs",
            "pubOrgSector": "Social",
            "targetAudienceStr": "General Public",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2314:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Visual and Performance Arts",
            "kClassName": "Flyer",
            "_label": "Flyer",
            "category": "Knowledge"
        },
        {
            "name": "Flyer",
            "timeRefFrom": 2014,
            "mainSource": "Google search",
            "geogFocus": "Global",
            "rating": 6,
            "description": "Not available",
            "retrievals": 1009,
            "language": "English, Estonian, Swedish, Belarusian, Russian, Finnish, Latvian, Lithuanian, Polish",
            "title": "Microplastics Polluting our Seas",
            "knowledgeId": "MPL_2345",
            "timeRefTo": 2014,
            "xcoord": 70,
            "commPurpose": "raise awareness",
            "resourceURL": "http:\/\/www.ccb.se\/evidence2015\/Mikroplastikccb-eng.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Microplastics Polluting our Seas",
            "likes": 2000,
            "participants": 150,
            "keyWords": "microplastics, marine environment, global assessment",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Marijana Tobin, Nadja Ziebarth",
            "hits": 99,
            "searchString": "Another search string here",
            "pubYear": 2015,
            "countryOrigin": "Sweden",
            "searchResultsPosition": 3,
            "ycoord": -270,
            "commPractice": "one to many, many to many",
            "pubName": "Coalition Clean Baltic (CCB)",
            "pubOrgType": "Local NGOs",
            "pubOrgSector": "Social",
            "targetAudienceStr": "General Public",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2313:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Other",
            "kClassName": "Flyer",
            "_label": "Flyer",
            "category": "Knowledge"
        },
        {
            "name": "Flyer",
            "timeRefFrom": 2014,
            "mainSource": "Google search",
            "geogFocus": "Global",
            "rating": 6,
            "description": "Not available",
            "retrievals": 1009,
            "language": "English, Estonian, Swedish, Belarusian, Russian, Finnish, Latvian, Lithuanian, Polish",
            "title": "Microplastics Polluting our Seas",
            "knowledgeId": "MPL_2345",
            "timeRefTo": 2014,
            "xcoord": 70,
            "commPurpose": "raise awareness",
            "resourceURL": "http:\/\/www.ccb.se\/evidence2015\/Mikroplastikccb-eng.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Microplastics Polluting our Seas",
            "likes": 2000,
            "participants": 150,
            "keyWords": "microplastics, marine environment, global assessment",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Marijana Tobin, Nadja Ziebarth",
            "hits": 99,
            "searchString": "Another search string here",
            "pubYear": 2015,
            "countryOrigin": "Sweden",
            "searchResultsPosition": 3,
            "ycoord": -270,
            "commPractice": "one to many, many to many",
            "pubName": "Coalition Clean Baltic (CCB)",
            "pubOrgType": "Local NGOs",
            "pubOrgSector": "Social",
            "targetAudienceStr": "General Public",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2312:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Broadcast Media",
            "kClassName": "Flyer",
            "_label": "Flyer",
            "category": "Knowledge"
        },
        {
            "name": "Flyer",
            "timeRefFrom": 2014,
            "mainSource": "Google search",
            "geogFocus": "Global",
            "rating": 6,
            "description": "Not available",
            "retrievals": 1009,
            "language": "English, Estonian, Swedish, Belarusian, Russian, Finnish, Latvian, Lithuanian, Polish",
            "title": "Microplastics Polluting our Seas",
            "knowledgeId": "MPL_2345",
            "timeRefTo": 2014,
            "xcoord": 70,
            "commPurpose": "raise awareness",
            "resourceURL": "http:\/\/www.ccb.se\/evidence2015\/Mikroplastikccb-eng.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Microplastics Polluting our Seas",
            "likes": 2000,
            "participants": 150,
            "keyWords": "microplastics, marine environment, global assessment",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Marijana Tobin, Nadja Ziebarth",
            "hits": 99,
            "searchString": "Another search string here",
            "pubYear": 2015,
            "countryOrigin": "Sweden",
            "searchResultsPosition": 3,
            "ycoord": -270,
            "commPractice": "one to many, many to many",
            "pubName": "Coalition Clean Baltic (CCB)",
            "pubOrgType": "Local NGOs",
            "pubOrgSector": "Social",
            "targetAudienceStr": "General Public",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2311:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Non Academic Press",
            "kClassName": "Flyer",
            "_label": "Flyer",
            "category": "Knowledge"
        },
        {
            "speciesComposition": "Decrease",
            "xcoord": 130,
            "specificComponentAffected": "Northern krill, Meganyctiphanes norvegica",
            "name": "Zooplankton",
            "description": "Contamination of Zooplankton Communities causing changes in species composition",
            "ycoord": -70,
            "_id": "#1069:0",
            "_type": "vertex",
            "_label": "Zooplankton",
            "category": "State"
        },
        {
            "name": "Flyer",
            "timeRefFrom": 2014,
            "mainSource": "Google search",
            "geogFocus": "Global",
            "rating": 6,
            "description": "Not available",
            "retrievals": 1009,
            "language": "English, Estonian, Swedish, Belarusian, Russian, Finnish, Latvian, Lithuanian, Polish",
            "title": "Microplastics Polluting our Seas",
            "knowledgeId": "MPL_2345",
            "timeRefTo": 2014,
            "xcoord": 70,
            "commPurpose": "raise awareness",
            "resourceURL": "http:\/\/www.ccb.se\/evidence2015\/Mikroplastikccb-eng.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Microplastics Polluting our Seas",
            "likes": 2000,
            "participants": 150,
            "keyWords": "microplastics, marine environment, global assessment",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Marijana Tobin, Nadja Ziebarth",
            "hits": 99,
            "searchString": "Another search string here",
            "pubYear": 2015,
            "countryOrigin": "Sweden",
            "searchResultsPosition": 3,
            "ycoord": -270,
            "commPractice": "one to many, many to many",
            "pubName": "Coalition Clean Baltic (CCB)",
            "pubOrgType": "Local NGOs",
            "pubOrgSector": "Social",
            "targetAudienceStr": "General Public",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2209:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Non Academic Press",
            "kClassName": "Flyer",
            "_label": "Flyer",
            "category": "Knowledge"
        },
        {
            "name": "IMPORTED Flash Mob",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 7,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 5,
            "language": "English",
            "title": "7Review of Microplastics in Cosmetics",
            "knowledgeId": "7MPL_2471",
            "timeRefTo": 2005,
            "xcoord": 100,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 3.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2,
            "participants": 4,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Thu Feb 08 00:00:00 GMT 2018",
            "author": "Lesley, H.A.",
            "hits": 1,
            "searchString": "A search string here",
            "pubYear": 2016,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": 100,
            "commPractice": "one to many",
            "pubName": "None specified",
            "pubOrgType": "Actor",
            "pubOrgSector": "None specified",
            "targetAudienceStr": "School Pupil",
            "mediaGroup": "Performative Arts",
            "mediaDegree": "First Degree Media",
            "_id": "#2141:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Visual and Performance Arts",
            "kClassName": "Flash Mob",
            "_label": "FlashMob",
            "category": "Knowledge"
        },
        {
            "name": "IMPORTED Flash Mob",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 7,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 5,
            "language": "English",
            "title": "7Review of Microplastics in Cosmetics",
            "knowledgeId": "7MPL_2471",
            "timeRefTo": 2005,
            "xcoord": 100,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 3.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2,
            "participants": 4,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Thu Feb 08 00:00:00 GMT 2018",
            "author": "Lesley, H.A.",
            "hits": 1,
            "searchString": "A search string here",
            "pubYear": 2016,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": 100,
            "commPractice": "one to many",
            "pubName": "None specified",
            "pubOrgType": "Actor",
            "pubOrgSector": "None specified",
            "targetAudienceStr": "School Pupil",
            "mediaGroup": "Performative Arts",
            "mediaDegree": "First Degree Media",
            "_id": "#2145:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Visual and Performance Arts",
            "kClassName": "Flash Mob",
            "_label": "FlashMob",
            "category": "Knowledge"
        },
        {
            "note": "",
            "name": "Pressure12",
            "weight": 0.9,
            "description": "causes state change",
            "_id": "#2377:2",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 270,
            "specificComponentAffected": "Sea butterfly, Limacina helicina",
            "ecologicalStatus": "Decrease",
            "name": "Pelagic Invertebrates",
            "description": "Contamination of Pelagic Invertebrates threatening Ecological Status",
            "ycoord": -70,
            "_id": "#1057:0",
            "_type": "vertex",
            "_label": "PelagicInvertebrates",
            "category": "State"
        },
        {
            "note": "",
            "name": "Pressure13",
            "weight": 1,
            "description": "causes state change",
            "_id": "#2378:2",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 400,
            "specificComponentAffected": "Round goby, Neogobius melanostomus",
            "abundanceOfPopulation": "Decrease",
            "name": "Fish Populations",
            "description": "Contamination of Fish Populations reducing population abundance",
            "ycoord": -100,
            "_id": "#1041:0",
            "_type": "vertex",
            "_label": "FishPopulations",
            "category": "State"
        },
        {
            "note": "",
            "name": "State11",
            "weight": 0.2,
            "description": "impacts",
            "_id": "#2377:3",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 390,
            "impact": "Biochemical and Mechnical Reduction and Distortion of Digestive, Metabolic or Endocrine Functions",
            "name": "Impact",
            "description": "Description of Impact on Fish Populations",
            "ycoord": 110,
            "_id": "#1109:0",
            "_type": "vertex",
            "_label": "Impact",
            "category": "Impact"
        },
        {
            "note": "",
            "name": "Impact11",
            "weight": 0.3,
            "description": "causes",
            "_id": "#2378:3",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 80,
            "essImpact": "Biomass nutrition reduction and contamination by toxins",
            "name": "Biomass nutrition",
            "description": "Reduction in the amount of nutrition by biomass",
            "ycoord": 300,
            "_id": "#1141:0",
            "_type": "vertex",
            "_label": "BiomassNutrition",
            "category": "Welfare"
        },
        {
            "note": "",
            "name": "Welfare11",
            "weight": 0.4,
            "description": "controlled by",
            "_id": "#2379:3",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -110,
            "name": "National Environmental Regulation",
            "description": "National Regulation to reduce or eliminate use of microplastics in personal care and cosmetic products",
            "ycoord": -90,
            "_id": "#1465:0",
            "_type": "vertex",
            "_label": "NationalEnvReg",
            "category": "Response"
        },
        {
            "note": "",
            "name": "Response11",
            "weight": 0.8,
            "description": "affects",
            "_id": "#2379:4",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "note": "",
            "name": "Welfare12",
            "weight": 0.5,
            "description": "controlled by",
            "_id": "#5555:3",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -270,
            "name": "International Agreement",
            "description": "International agreement to reduce or eliminate use of microplastics in personal care and cosmetic products",
            "ycoord": -30,
            "_id": "#1497:0",
            "_type": "vertex",
            "_label": "InternationalAgreement",
            "category": "Response"
        },
        {
            "note": "",
            "name": "Response12",
            "weight": 0.9,
            "description": "affects",
            "_id": "#2380:4",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "note": "",
            "name": "Welfare13",
            "weight": 0.6,
            "description": "controlled by",
            "_id": "#2377:4",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -580,
            "name": "Voluntarism",
            "description": "Voluntary Measure to reduce or eliminate use of microplastics in personal care and cosmetic products",
            "ycoord": 150,
            "_id": "#1509:0",
            "_type": "vertex",
            "_label": "Voluntarism",
            "category": "Response"
        },
        {
            "note": "",
            "name": "Response13",
            "weight": 1,
            "description": "affects",
            "_id": "#2377:5",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "note": "",
            "name": "Welfare14",
            "weight": 0.7,
            "description": "controlled by",
            "_id": "#2378:4",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -400,
            "name": "Changing Values and Attitudes",
            "description": "Encouraging the consumer to reduce or eliminate use of personal care and cosmetic products containing microplastics",
            "ycoord": 70,
            "_id": "#1585:0",
            "_type": "vertex",
            "_label": "ChangingValues",
            "category": "Response"
        },
        {
            "note": "",
            "name": "Response14",
            "weight": 0.4,
            "description": "affects",
            "_id": "#2378:5",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "note": "",
            "name": "Pressure14",
            "weight": 0,
            "description": "causes state change",
            "_id": "#2379:2",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 510,
            "specificComponentAffected": "test",
            "naturalAndActualRange": "Decrease",
            "name": "Marine Mammals",
            "description": "Contamination of Marine Mammal xxx threatening range",
            "ycoord": -160,
            "_id": "#1045:0",
            "_type": "vertex",
            "_label": "MarineMammals",
            "category": "State"
        },
        {
            "note": "",
            "name": "Pressure15",
            "weight": 0.1,
            "description": "causes state change",
            "_id": "#2380:2",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": 560,
            "specificComponentAffected": "Yelkouan shearwater, Puffinus yelkouan",
            "populationDynamics": "Decrease in young population",
            "name": "Seabirds",
            "description": "Contamination of Seabirds changing Population Dynamics",
            "ycoord": -260,
            "_id": "#1053:0",
            "_type": "vertex",
            "_label": "Seabirds",
            "category": "State"
        },
        {
            "xcoord": -20,
            "name": "Consumer",
            "description": "Consumer of cosmetic products",
            "ycoord": -830,
            "_id": "#1925:0",
            "_type": "vertex",
            "_label": "Consumer",
            "category": "Actor"
        },
        {
            "xcoord": -360,
            "name": "Retailers",
            "description": "Retailers of cosmetic products",
            "ycoord": -790,
            "_id": "#1785:0",
            "_type": "vertex",
            "_label": "Retailers",
            "category": "Actor"
        },
        {
            "xcoord": -270,
            "name": "Cosmetics Manufacturers",
            "description": "Manufacturers of cosmetic products containing microplastics",
            "ycoord": -580,
            "_id": "#1721:0",
            "_type": "vertex",
            "_label": "Manufacturers",
            "category": "Actor"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2177:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Online Digital Media",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2178:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Other",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2179:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Film",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2180:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Broadcast Media",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2181:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Non Academic Press",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2182:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Education and Public Events",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2184:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Visual and Performance Arts",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Scientific Article",
            "timeRefFrom": 2000,
            "mainSource": "Google search",
            "geogFocus": "EU",
            "rating": 8,
            "description": "Scientific background on a potential source of plastic particulate marine litter to support decision-making.",
            "retrievals": 1200,
            "language": "English",
            "title": "Review of Microplastics in Cosmetics",
            "knowledgeId": "MPL_1234",
            "timeRefTo": 2014,
            "xcoord": -530,
            "commPurpose": "educate, inform",
            "resourceURL": "http:\/\/www.ivm.vu.nl\/en\/Images\/Plastic_ingredients_in_Cosmetics_07-2014_FINAL_tcm234-409859.pdf",
            "impactFactor": 1.3,
            "englishTitle": "Review of Microplastics in Cosmetics",
            "likes": 2000,
            "participants": 12,
            "keyWords": "toothpaste, cosmetics, microplastics",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Lesley, H.A.",
            "hits": 99,
            "searchString": "A search string here",
            "pubYear": 2014,
            "countryOrigin": "Netherlands",
            "searchResultsPosition": 7,
            "ycoord": -540,
            "commPractice": "one to many",
            "pubName": "IVM Institute for Environmental Studies",
            "pubOrgType": "Scientific Knowledge Producers",
            "pubOrgSector": "Professional",
            "targetAudienceStr": "Fishermen, School Pupil",
            "mediaGroup": "Print Media",
            "mediaDegree": "Second Degree Media",
            "_id": "#2183:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Visual and Performance Arts",
            "kClassName": "Scientific Article",
            "_label": "ScientificArticle",
            "category": "Knowledge"
        },
        {
            "name": "Website",
            "timeRefFrom": 2005,
            "mainSource": "Google Scholar",
            "geogFocus": "Global",
            "rating": 3,
            "description": "Not available",
            "retrievals": 3452,
            "language": "English",
            "title": "Microplastics - The Story of Stuff Project",
            "knowledgeId": "MPL_3456",
            "timeRefTo": 2010,
            "xcoord": -470,
            "commPurpose": "build consensus",
            "resourceURL": "http:\/\/storyofstuff.org\/plastic-microbeads-ban-the-bead\/",
            "impactFactor": 1.3,
            "englishTitle": "Microplastics - The Story of Stuff Project",
            "likes": 2000,
            "participants": 51,
            "keyWords": "Nanotoxicology, Cytotoxicity, Nanoparticles, Subcellular localization, Apoptosis",
            "accessLevel": "Public",
            "entryDate": "Fri May 01 00:00:00 BST 2015",
            "author": "Unspecified",
            "hits": 99,
            "searchString": "Academic search string here",
            "pubYear": 2015,
            "countryOrigin": "USA",
            "searchResultsPosition": 12,
            "ycoord": -470,
            "commPractice": "one to many, many to many",
            "pubName": "The Story of Stuff",
            "pubOrgType": "Administrators",
            "pubOrgSector": "Regulatory",
            "targetAudienceStr": "Fishermen, Actor",
            "mediaGroup": "Online Digital Media",
            "mediaDegree": "Third Degree Media",
            "_id": "#2305:0",
            "_type": "vertex",
            "ownedBy": "Caroline Brennan",
            "ownerOrg": "NUIG",
            "kGroup": "Scientific Print Media",
            "kClassName": "Website",
            "_label": "Website",
            "category": "Knowledge"
        },
        {
            "xcoord": -620,
            "name": "Material Availability",
            "description": "Plastic is cheap and its use is personal care and cosmetics products is increasing",
            "ycoord": -840,
            "_id": "#117:0",
            "_type": "vertex",
            "_label": "MaterialAvailability",
            "category": "Driver"
        },
        {
            "note": "",
            "name": "Driver12",
            "weight": 0.2,
            "description": "drives",
            "_id": "#2378:0",
            "_type": "vertex",
            "_label": "LinkEvidence"
        },
        {
            "xcoord": -470,
            "name": "Microplastics Manufacturers",
            "description": "Manufacturers of microplastics for use in the cosmetic industry",
            "ycoord": -800,
            "_id": "#1722:0",
            "_type": "vertex",
            "_label": "Manufacturers",
            "category": "Actor"
        },
        {
            "xcoord": -710,
            "name": "Material Science and Technology Developments",
            "description": "More and more forms of plastic are available",
            "ycoord": -750,
            "_id": "#149:0",
            "_type": "vertex",
            "_label": "MatScienceTechDev",
            "category": "Driver"
        },
        {
            "note": "",
            "name": "Driver13",
            "weight": 0.3,
            "description": "drives",
            "_id": "#2379:0",
            "_type": "vertex",
            "_label": "LinkEvidence"
        }],
    "edges": [{
            "description": "Story starts",
            "linkType": "S",
            "_id": "#13:0",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#93:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#16:0",
            "_type": "edge",
            "_outV": "#93:0",
            "_inV": "#2377:0",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#13:1",
            "_type": "edge",
            "_outV": "#2377:0",
            "_inV": "#673:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:2",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2380:0",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:2",
            "_type": "edge",
            "_outV": "#2380:0",
            "_inV": "#469:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:3",
            "_type": "edge",
            "_outV": "#469:0",
            "_inV": "#2377:1",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:3",
            "_type": "edge",
            "_outV": "#2377:1",
            "_inV": "#261:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:3",
            "_type": "edge",
            "_outV": "#261:0",
            "_inV": "#2378:1",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:3",
            "_type": "edge",
            "_outV": "#2378:1",
            "_inV": "#441:0",
            "_label": null
        },
        {
            "linkType": "A",
            "_id": "#16:4",
            "_type": "edge",
            "_outV": "#441:0",
            "_inV": "#1949:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:5",
            "_type": "edge",
            "_outV": "#441:0",
            "_inV": "#2379:1",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:5",
            "_type": "edge",
            "_outV": "#2379:1",
            "_inV": "#957:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:5",
            "_type": "edge",
            "_outV": "#957:0",
            "_inV": "#2380:1",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:5",
            "_type": "edge",
            "_outV": "#2380:1",
            "_inV": "#1069:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:14",
            "_type": "edge",
            "_outV": "#2380:1",
            "_inV": "#2311:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:14",
            "_type": "edge",
            "_outV": "#2380:1",
            "_inV": "#2312:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:14",
            "_type": "edge",
            "_outV": "#2380:1",
            "_inV": "#2313:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:14",
            "_type": "edge",
            "_outV": "#2380:1",
            "_inV": "#2314:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:6",
            "_type": "edge",
            "_outV": "#957:0",
            "_inV": "#2377:2",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:6",
            "_type": "edge",
            "_outV": "#2377:2",
            "_inV": "#1057:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:6",
            "_type": "edge",
            "_outV": "#957:0",
            "_inV": "#2378:2",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:6",
            "_type": "edge",
            "_outV": "#2378:2",
            "_inV": "#1041:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:8",
            "_type": "edge",
            "_outV": "#1041:0",
            "_inV": "#2377:3",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:8",
            "_type": "edge",
            "_outV": "#2377:3",
            "_inV": "#1109:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:8",
            "_type": "edge",
            "_outV": "#1109:0",
            "_inV": "#2378:3",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:8",
            "_type": "edge",
            "_outV": "#2378:3",
            "_inV": "#1141:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:9",
            "_type": "edge",
            "_outV": "#1141:0",
            "_inV": "#2379:3",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:9",
            "_type": "edge",
            "_outV": "#2379:3",
            "_inV": "#1465:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:11",
            "_type": "edge",
            "_outV": "#1465:0",
            "_inV": "#2379:4",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:11",
            "_type": "edge",
            "_outV": "#2379:4",
            "_inV": "#673:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:9",
            "_type": "edge",
            "_outV": "#1141:0",
            "_inV": "#5555:3",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:9",
            "_type": "edge",
            "_outV": "#5555:3",
            "_inV": "#1497:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:11",
            "_type": "edge",
            "_outV": "#1497:0",
            "_inV": "#2380:4",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:11",
            "_type": "edge",
            "_outV": "#2380:4",
            "_inV": "#673:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:10",
            "_type": "edge",
            "_outV": "#1141:0",
            "_inV": "#2377:4",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:10",
            "_type": "edge",
            "_outV": "#2377:4",
            "_inV": "#1509:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:12",
            "_type": "edge",
            "_outV": "#1509:0",
            "_inV": "#2377:5",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:12",
            "_type": "edge",
            "_outV": "#2377:5",
            "_inV": "#93:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:10",
            "_type": "edge",
            "_outV": "#1141:0",
            "_inV": "#2378:4",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:10",
            "_type": "edge",
            "_outV": "#2378:4",
            "_inV": "#1585:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:12",
            "_type": "edge",
            "_outV": "#1585:0",
            "_inV": "#2378:5",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:12",
            "_type": "edge",
            "_outV": "#2378:5",
            "_inV": "#93:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#13:7",
            "_type": "edge",
            "_outV": "#957:0",
            "_inV": "#2379:2",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#14:7",
            "_type": "edge",
            "_outV": "#2379:2",
            "_inV": "#1045:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#15:7",
            "_type": "edge",
            "_outV": "#957:0",
            "_inV": "#2380:2",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#16:7",
            "_type": "edge",
            "_outV": "#2380:2",
            "_inV": "#1053:0",
            "_label": null
        },
        {
            "linkType": "A",
            "_id": "#15:4",
            "_type": "edge",
            "_outV": "#261:0",
            "_inV": "#1925:0",
            "_label": null
        },
        {
            "linkType": "A",
            "_id": "#14:4",
            "_type": "edge",
            "_outV": "#469:0",
            "_inV": "#1785:0",
            "_label": null
        },
        {
            "linkType": "A",
            "_id": "#13:4",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#1721:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2177:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2184:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2183:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2182:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2181:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2180:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2179:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 30,
            "_id": "#16:13",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2178:0",
            "_label": null
        },
        {
            "description": "Supported by",
            "linkType": "K",
            "relevance": 70,
            "_id": "#13:14",
            "_type": "edge",
            "_outV": "#673:0",
            "_inV": "#2305:0",
            "_label": null
        },
        {
            "description": "Story starts",
            "linkType": "S",
            "_id": "#14:0",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#117:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#14:1",
            "_type": "edge",
            "_outV": "#117:0",
            "_inV": "#2378:0",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#15:1",
            "_type": "edge",
            "_outV": "#2378:0",
            "_inV": "#673:0",
            "_label": null
        },
        {
            "linkType": "A",
            "_id": "#14:2",
            "_type": "edge",
            "_outV": "#2378:0",
            "_inV": "#1722:0",
            "_label": null
        },
        {
            "description": "Story starts",
            "linkType": "S",
            "_id": "#15:0",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#149:0",
            "_label": null
        },
        {
            "linkType": "C1",
            "_id": "#16:1",
            "_type": "edge",
            "_outV": "#149:0",
            "_inV": "#2379:0",
            "_label": null
        },
        {
            "linkType": "C2",
            "_id": "#13:2",
            "_type": "edge",
            "_outV": "#2379:0",
            "_inV": "#673:0",
            "_label": null
        },
        {
            "edgeYcoord": -540,
            "description": "Invisible",
            "linkType": "Invisible",
            "edgeXcoord": -530,
            "_id": "#13:13",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#2177:0",
            "_label": null
        },
        {
            "edgeYcoord": -270,
            "description": "Invisible",
            "linkType": "Invisible",
            "edgeXcoord": 70,
            "_id": "#14:13",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#2209:0",
            "_label": null
        },
        {
            "edgeYcoord": -470,
            "description": "Invisible",
            "linkType": "Invisible",
            "edgeXcoord": -470,
            "_id": "#15:13",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#2305:0",
            "_label": null
        },
        {
            "edgeYcoord": -880,
            "description": "Invisible",
            "linkType": "Invisible",
            "edgeXcoord": -643,
            "_id": "#16:20",
            "_type": "edge",
            "_outV": "#17:0",
            "_inV": "#2141:0",
            "_label": null
        }]
};


window.onload = function(){
 setTimeout(function(){
  drawNavigator();
  drawAllKnowledge();
 }, 1);
};
var parentNodes = [];
var pageLoadTimer;
//console.log(pageLoadTimer);
var length = smallJSONData.vertices.length;
var getCausalEvidence=false;
var icons = joint.shapes.kb.icons;
var combinedKnowledgeNodes = [];

// Lookup table for icons
var iconTable = joint.shapes.kb.iconLookupTable;
var iconString;
var graph = new joint.dia.Graph();


var drawnknowledgeNodes = [];
var verticesCount;
var length = smallJSONData.vertices.length;
var storyAmount = 0;
var driverAmount = 0;
var activityAmount = 0;
var pressureAmount = 0;
var stateAmount = 0;
var impactAmount = 0;
var welfareAmount = 0;
var responseAmount = 0;
var max = 0;

for (verticesCount = 0; verticesCount < length; verticesCount++)
{
    var vertexType = (smallJSONData.vertices[verticesCount]['category']);
    if (vertexType === "Story")
    {
        storyAmount++;
        if (storyAmount > max) {
            max = storyAmount;
        }
    }
    if (vertexType === "Driver")
    {
        driverAmount++;
        if (driverAmount > max) {
            max = driverAmount;
        }
    }
    if (vertexType === "Activity")
    {
        activityAmount++;
        if (activityAmount > max) {
            max = activityAmount;
        }
    }
    if (vertexType === "Pressure")
    {
        pressureAmount++;
        if (pressureAmount > max) {
            max = pressureAmount;
        }
    }
    if (vertexType === "State")
    {
        stateAmount++;
        if (stateAmount > max) {
            max = stateAmount;
        }
    }
    if (vertexType === "Impact")
    {
        impactAmount++;
        if (impactAmount > max) {
            max = impactAmount;
        }
    }
    if (vertexType === "Welfare")
    {
        welfareAmount++;
        if (welfareAmount > max) {
            max = welfareAmount;
        }
    }
    if (vertexType === "Response")
    {
        responseAmount++;
        if (responseAmount > max) {
            max = responseAmount;
        }
    }
}
var height = (max * 200);
var width = 1800;
var paper = new joint.dia.Paper({
    //el: document.getElementById('paper-container'),
    width: width,
    height: height,
    gridSize: 10,
    model: graph,
    linkPinning: false,
    drawGrid: true,
    interactive: false
});
//
var paperScroller = new joint.ui.PaperScroller({
    paper: paper,
//    autoResizePaper: true
});

$('.paper-container').append(paperScroller.render().el);
// this.paperScroller.center();

//
//var navigato = this.navigato = new joint.ui.Navigator({
//    paperScroller: this.paperScroller,
//    width: 250,
//    height: 235,
//    padding: 10,
//    zoomOptions: {max: 5, min: 0.2}
//});
//navigato.$el.appendTo('.paper-navigator');
//navigato.render();

function drawNavigator(){
    var navigato = this.navigato = new joint.ui.Navigator({
    paperScroller: this.paperScroller,
    width: 250,
    height: 235,
    padding: 10,
    zoomOptions: {max: 5, min: 0.2}
});
navigato.$el.appendTo('.paper-navigator');
navigato.render();
}

paper.on('cell:pointerdown', function (cellView) {
    
    $('.displayNodeData').empty();
    $('.displayNodeDataButton').css("display", "none");
    $('.displayActorsData').empty();
    $('.displayActorsDataButton').css("display", "none");
    $('.displayKnowledgeperNode').empty();
    $('.displayKnowledgeForNodeButton').css("display", "none");
    $('.viewCausalSummry').css("display", "none");
    
    var nodes = [];
    var links = [];
    var nodeKnowledgeData = [];
    var nodeActors = [];
    var nodeData;
    var nodeType;

//retrieve the nodeData and the nodetype when user clicks a specific node
if(getCausalEvidence===false){
    cellView.unhighlight();
    console.log("cellView = ",cellView);
    nodeData = cellView.model.attributes.nodeData;
    nodeType = cellView.model.attributes.type;
    //cycle through all cells in the graph
    graph.get('cells').find(function (cell) {

        //find out what knowledge nodes and Actor nodes are connected to a particular node. Don't
        //need to consider nodes of type knowledge and Actor for this
        if (cell.get('type') !== 'kb.Knowledge' && cell.get('type') !== 'kb.ActorNode') {
            //if the id of the a cell in graph matchs the one that was clicked
            if (cell.id === cellView.model.id) {
                nodes = graph.getNeighbors(cell, [false, true]);
                _.each(nodes, function (kNode) {
                    if (kNode.get('type') === 'kb.Knowledge') {
                        nodeKnowledgeData.push(kNode.attributes.supportingKnowledge);
                    }
                    if (kNode.get('type') === 'kb.ActorNode') {
                        nodeActors.push(kNode.attributes.nodeData);
                    }
                });
            }
        }

        //show all knowledge or actor nodes attached to the node the user has clicked a parent node
        if (cell.get('type') !== 'kb.Knowledge' && cell.get('type') !== 'kb.ActorNode') {
            if (cell.id === cellView.model.id) {
                //get all connected nodes and links in the outbound direction  
                links = graph.getConnectedLinks(cell, [false, true]);
                nodes = graph.getNeighbors(cell, [false, true]);
                //draw only actor links
                _.each(links, function (actorLink) {
                    if (actorLink.get('type') === "kb.ActorLink") {
                        //if knowledge and actors are already displayed then turn them off and vice versa
                        status = actorLink.attr('./display');
                        if (status === 'none') {
                            actorLink.attr('./display', 'block');

                        } else {
                            actorLink.attr('./display', 'none');
                        }
                    }
                });
                //draw the knowledge and Actor nodes
                _.each(nodes, function (knowledgeActorNode) {
                    if (knowledgeActorNode.get('type') === "kb.Knowledge" || knowledgeActorNode.get('type') === "kb.ActorNode") {
                        status = knowledgeActorNode.attr('./display');
                        if (status === 'none') {
                            knowledgeActorNode.attr('./display', 'block');
                        } else {
                            knowledgeActorNode.attr('./display', 'none');
                        }
                    }
                });
            }
        }

    });

    //if conditions are met append the knowledge on the right hand side viewer 
    if (nodeType !== "kb.Rel" && nodeData.length !== 0) {
        displayNodeData(nodeData);
    }
    if (nodeKnowledgeData.length !== 0) {
        displayNodeKnowledge(nodeKnowledgeData);
    }
    if (nodeActors.length !== 0) {
        displayActorNodes(nodeActors);
    }

    }
    if (getCausalEvidence === true) {
        nodeType = cellView.model.attributes.type;
        graph.get('cells').find(function (cell) {
            if (cell.id === cellView.model.id) {
                if (nodeType !== "kb.Rel" && nodeType !== "kb.Knowledge" && nodeType !== "kb.ActorNode") {
                    cellView.highlight();
                    if (document.getElementById("finishNode").value === "finishNodeId" && document.getElementById("startNode").value !== "startNodeId")
                    {
                        document.getElementById("finishNode").value = cell.attributes.databaseId;
                        document.getElementById("finishNodeName").value = cell.attributes.nodeData.name;
                    }
                    if (document.getElementById("startNode").value === "startNodeId")
                    {
                        document.getElementById("startNode").value = cell.attributes.databaseId;
                        document.getElementById("startNodeName").value = cell.attributes.nodeData.name;
                    }

                }
            }
        });
    }
});
//var startNode="";
//var finishNode="";
//var myHighlighter = false;
//var myHighlighter = {
//      highlighter: {
//        name: 'addClass',
//        options: {
//          className: 'highlighted'
//        }
//      }
//    }
var responseNodes = [];
var actorNodes = [];
var edgesCount = 0;
var edgesLength = smallJSONData.edges.length;
var targetCanvasId;
var sourceCanvasId;
var storyX = (width / (8)) - 200;
var storyYstep = (height / (storyAmount + 1));
var storyY = 0;
var driverX = (width / (8) * 2) - 200;
var driverYstep = (height / (driverAmount + 1));
var driverY = 0;
var activityX = (width / (8) * 3) - 200;
var activityYstep = (height / (activityAmount + 1));
var activityY = 0;
var pressureX = ((width / 8) * 4) - 200;
var pressureYstep = (height / (pressureAmount + 1));
var pressureY = 0;
var stateX = ((width / 8) * 5) - 200;
var stateYstep = (height / (stateAmount + 1));
var stateY = 0;
var impactX = ((width / 8) * 6) - 200;
var impactYstep = (height / (impactAmount + 1));
var impactY = 0;
var welfareX = ((width / 8) * 7) - 200;
var welfareYstep = (height / (welfareAmount + 1));
var welfareY = 0;
var responseX = ((width / 8) * 8) - 200;
var responseYstep = (height / (responseAmount + 1));
var responseY = 0;

for (verticesCount = 0; verticesCount < length; verticesCount++)
{
    var shortText = smallJSONData.vertices[verticesCount].name;
    if (shortText.length > 15) {
        shortText = shortText.substring(0, 15) + "...";
    }

    var name = smallJSONData.vertices[verticesCount].name;
    var categoryType = (smallJSONData.vertices[verticesCount]['category']);

    if (categoryType === "Story")
    {
        storyY = storyY + storyYstep;

        var shapes = new joint.shapes.kb.Framework({
            position: {x: storyX, y: storyY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            xcoord: storyX,
            type: 'kb.Story',
            ycoord: storyY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);

    }
    if (categoryType === "Driver")
    {
        driverY = driverY + driverYstep;

        var shapes = new joint.shapes.kb.Framework({
            position: {x: driverX, y: driverY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.Driver',
            xcoord: driverX,
            ycoord: driverY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }

    if (categoryType === "Activity")
    {
        activityY = activityY + activityYstep;

        var shapes = new joint.shapes.kb.Framework({
            position: {x: activityX, y: activityY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.Activity',
            xcoord: activityX,
            ycoord: activityY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }
    if (categoryType === "Pressure")
    {
        pressureY = pressureY + pressureYstep;

        var shapes = new joint.shapes.kb.Framework({
            position: {x: pressureX, y: pressureY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.Pressure',
            xcoord: pressureX,
            ycoord: pressureY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }
    if (categoryType === "State")
    {
        stateY = stateY + stateYstep;
        var shapes = new joint.shapes.kb.Framework({
            position: {x: stateX, y: stateY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.State',
            xcoord: stateX,
            ycoord: stateY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }
    if (categoryType === "Impact")
    {
        impactY = impactY + impactYstep;
        var shapes = new joint.shapes.kb.Framework({
            position: {x: impactX, y: impactY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.Impact',
            xcoord: impactX,
            ycoord: impactY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }
    if (categoryType === "Welfare")
    {
        welfareY = welfareY + welfareYstep;

        var shapes = new joint.shapes.kb.Framework({
            position: {x: welfareX, y: welfareY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 'none',
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.Welfare',
            xcoord: welfareX,
            ycoord: welfareY
        });
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }
    if (categoryType === "Response")
    {
        responseY = responseY + responseYstep;

        var shapes = new joint.shapes.kb.Framework({
            position: {x: responseX, y: responseY},
            attrs: {
                text: {
                    fill: '#000000',
                    text: shortText,
                    'letter-spacing': 0,
                    style: {'text-shadow': '1px 0 1px #333333'}
                },
                '.outer, .inner': {
                    fill: '#31d0c6',
                    stroke: 8,
                    filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                }
            },
            databaseId: smallJSONData.vertices[verticesCount]._id,
            nodeData: smallJSONData.vertices[verticesCount],
            type: 'kb.Response',
            xcoord: responseX,
            ycoord: responseY
        });
        responseNodes.push(smallJSONData.vertices[verticesCount]);
        iconString = iconTable[categoryType];
        shapes.attr('image/xlink:href', icons[iconString]);
    }
    if (categoryType === "Actor")
    {
        actorNodes.push(smallJSONData.vertices[verticesCount]);
    }
    graph.addCells(shapes);
}

for (edgesCount; edgesCount < edgesLength; edgesCount++) {
    var drawEdge = true;
    //review can detect backwards links by using x position of each node i.e if targetx < source x then don't draw it
    if (smallJSONData.edges[edgesCount].linkType === 'C1')
    {
         //check to see if the response nodes have backwards links. If so hide them on the graph
        _.each(responseNodes, function (node) {
            if (smallJSONData.edges[edgesCount]._outV === node._id) {
                drawEdge = false;
            }
        });
        if(drawEdge){
        // Find the source id of the causal relationship
        sourceCanvasId = getCanvasIdByDatabaseId(smallJSONData.edges[edgesCount]._outV, this.graph);

        // Loop through the edges in the JSON data to find the target vertex
        // Get database id of intermediate vertex ie the linkEvidence node
        var c1targetNode = smallJSONData.edges[edgesCount]._inV;
        
        // Find link with '_outV' equal to intermediate vertex id and property
        // linkType equal to 'C2'.

        _.each(smallJSONData.edges, function (link) {
            if ((link._outV === c1targetNode) && (link.linkType === 'C2'))
            {
                c2Link = link;
            }
        });

        // Get the target vertex
        //var newTargetCanvasId = getCanvasIdByDatabaseId( secondLink._inV, this.graph );
        targetCanvasId = getCanvasIdByDatabaseId(c2Link._inV, this.graph);

        // Create a Causal link between vertices
        newCanvasEdge = new joint.shapes.kb.CausalLink({
            source: {id: sourceCanvasId},
            target: {id: targetCanvasId},
            attrs: {
                '.connection': {stroke: '#600', 'stroke-width': 4},
            }
        });

//                 // set the labels at either end of the node (optional)
//                newCanvasEdge.label(0, {attrs:{ text: { text: '' }}});
//                newCanvasEdge.label(1, {attrs:{ text: { text: '' }}});

////check to see if the response nodes have backwards links. If so hide them on the graph
//        _.each(responseNodes, function (node) {
//            if (smallJSONData.edges[edgesCount]._outV === node._id) {
//                drawEdge = false;
//            }
//        });
//        if (drawEdge) {
            graph.addCell(newCanvasEdge);
            //add datrabaseid to the link evidnce node to allow knowledge and actors to be connected to it.
            newCanvasEdge.setup(smallJSONData.edges[edgesCount]._inV);
    }
}
    if (smallJSONData.edges[edgesCount].linkType === 'S')
    {
        // Find the source id of the causal relationship
        sourceCanvasId = getCanvasIdByDatabaseId(smallJSONData.edges[edgesCount]._outV, this.graph);
        targetCanvasId = getCanvasIdByDatabaseId(smallJSONData.edges[edgesCount]._inV, this.graph);
        newCanvasEdge = new joint.shapes.fsa.Arrow({
            source: {id: sourceCanvasId},
            target: {id: targetCanvasId},
            attrs: {
                '.connection': {stroke: '#600', 'stroke-width': 4}
            }
        });
        graph.addCell(newCanvasEdge);

    }
}
function drawAllKnowledge(){
//construct kNodes
var knowledgeNodeId = 0;
_.each(smallJSONData.vertices, function (node) {
    var knowledgePerNode = [];
    _.each(smallJSONData.edges, function (link) {
        if (link.linkType === "A" && link._outV === node._id) {
            positionActorNode(link._outV, link._inV, actorNodes, this.graph);
        }
        //if link of type K and it source node is the current node
        if (link.linkType === "K" && link._outV === node._id) {
            _.each(smallJSONData.vertices, function (knowledgeNode) {
                if(knowledgeNode.category === "Knowledge"){
                if (knowledgeNode._id === link._inV) {
                    knowledgePerNode.push(knowledgeNode);
                }
            }
            });
        }
    });
    if (knowledgePerNode.length !== 0) {
        displayKnowledge(knowledgePerNode, node, knowledgeNodeId++, this.graph);
    }
});
}

function positionActorNode(sourceNode, targetNode, actorNodes, graph) {
    var x = 0;
    var y = 0;
    var categoryType = "Actor";
    var name = "";
    _.each(graph.getElements(), function (nodes) {
        if (nodes.get('databaseId') === sourceNode) {
            nodePosition = nodes.get('position');
            x = nodePosition.x;
            y = nodePosition.y;
            x = x + 150;
            _.each(actorNodes, function (actNode) {
                if (actNode._id === targetNode) {
                    name = actNode.name;
                    var actorNode = new joint.shapes.kb.Framework({
                        position: {x: x, y: y},
                        attrs: {
                            text: {
                                fill: '#000000',
                                text: name,
                                'letter-spacing': 0,
                                style: {'text-shadow': '1px 0 1px #333333'}
                            },
                            '.outer, .inner': {
                                fill: '#31d0c6',
                                stroke: 'none',
                                filter: {name: 'dropShadow', args: {dx: 0.555, dy: 20, blur: 20, color: '#99'}}
                            }
                        },
                        databaseId: actNode._id,
                        type: 'kb.ActorNode',
                        nodeData: actNode
                    });

                    iconString = iconTable[categoryType];
                    actorNode.attr('image/xlink:href', icons[iconString]);
                    actorNode.attr('./display', 'none');
                    graph.addCell(actorNode);

                    sourceCanvasId = getCanvasIdByDatabaseId(sourceNode, this.graph);
                    targetCanvasId = getCanvasIdByDatabaseId(targetNode, this.graph);
                    actorLink = new joint.shapes.kb.ActorLink({
                        source: {id: sourceCanvasId},
                        target: {id: targetCanvasId},
                        attrs: {
                            '.connection': {stroke: '#600', 'stroke-width': 4}
                        }
                    });
                    actorLink.attr('./display', 'none');
                    graph.addCell(actorLink);
                }
            });
        }
    });
}
function getCanvasIdByDatabaseId(databaseId, graph)
{
    var returnValue = null;
    // Go through each of the elements in the graph and find the 
    // element that contains the databaseId 
    _.each(graph.getElements(), function (el) {
        if (el.get('databaseId') === databaseId)
        {
            returnValue = el.get('id');
        }
    });

    return returnValue;
}

//function that shows all knowledge nodes on the graph when clicked
function drawAllKnowledgeNodes(data) {
    
    _.each(this.graph.getElements(), function (el) {
        if (data === 'false') {
            if (el.get('type') === "kb.Knowledge") {
                el.attr('./display', 'block');
            }
        } else {
            if (el.get('type') === "kb.Knowledge") {
                el.attr('./display', 'none');
            }
        }
    });
};

//when the switch is turned on set the gloabl variable getCausalEvidence to true and false when off 
$(".getCausalEvidenceSummarySwitch").on('click', function() {
  //determine if the switch is on or off
    var val = [];
    $(':checkbox:checked').each(function(i){
      val[i] = $(this).val();
    });
    if (val[0] === "on"){
        getCausalEvidence=true;
        $(".findCausalDataStartToFinish").css("display","");
    }
    else{
        getCausalEvidence=false;
        $(".findCausalDataStartToFinish").css("display","none");
    }
});

function displayCausalEvidence(startNode,endNode) {
    if(startNode === "startNode" || endNode === "finishNode"){
        window.alert("Must select both a start and end node");
    }
    else{
//    $('#btnGetEvidenceSingle').on('click', function () {
//
//    // Adjacent DAPSIWR nodes:
//    var fromNode = startNode;
//    var toNode = endNode;
//    
//    // Demonstrate result of querying on a link that has no Knowledge (in my local test db):
//    // var fromNode = "441:3";
//    // var toNode = "957:3";    
//    // Valid JSON is returned, but the evidence property contains an empty array []
//    
//    // Demonstrate error - the two nodes are not connected (left to right)
//    // var fromNode = "1053:3";
//    // var toNode = "1109:3";    
//        
//    var web_service_url = "webresources/mkb/getcausalevidence/" + fromNode + "/" + toNode;
//    alert(web_service_url);
//
//    $.ajax({
//        async: false,
//        type: "GET",
//        url: web_service_url,
//        dataType: "json",
//        contentType: "text/plain",
//        headers: {'X-Authorization-Token': token.toString()},            
//        success: function (data, textStatus, jqXHR) {
//            casualEvidence = data;
//
//            if (data.error)
//            {
//                if (data.error === "Authentication Error (Session Timed Out)") {
//                    // Session timed out due to inactivity
//                    window.location.href = "login.html";
//                } else if (data.error === "Authentication Error (No valid session token)") {
//                    // Token not found in logged in users list
//                    window.location.href = "login.html";                    
//                } else {
//                    ShowAlert(data.error);
//                }
//            } else {
//                $('#json_output').val(JSON.stringify(jsonData, null, 2));
//            }
//        },
//        error: function (jqXHR, textStatus, errorThrown) {
//            ShowAlert(errorThrown);
//        }
//    });
//
//});
    
    var evidence = [];
    var visualPerformanceArtsData =[];
    var educationPublicEventsData=[];
    var nonAcademicPressData=[];
    var scientificPrintMediaData=[];
    var broadcastMediaData=[];
    var filmData=[];
    var otherData=[];
    var onlineDigitalMediaData=[];
    var knowledgeData=[];
    
    if (getCausalEvidence === true) {
        var casualEvidence = causalEvidence;
        _.each(casualEvidence, function (parentToParent) {
            _.each(parentToParent.evidence,function(causalEvidenceArray){
                    evidence.push(causalEvidenceArray);
            });
        });
    //iterate overy every Knowledge node attached and determine how many of each node type occur 
    _.each(evidence, function (nodeType) {
        if (nodeType.knowledge.kGroup === 'Visual and Performance Arts') {
            visualPerformanceArtsData.push(nodeType);
        }
        if (nodeType.knowledge.kGroup === 'Education and Public Events') {
            educationPublicEventsData.push(nodeType);
        }
        if (nodeType.knowledge.kGroup === 'Non Academic Press') {
            nonAcademicPressData.push(nodeType);
        }
        if (nodeType.knowledge.kGroup=== 'Scientific Print Media') {
            scientificPrintMediaData.push(nodeType);
        }
        if (nodeType.knowledge.kGroup === 'Broadcast Media') {
            broadcastMediaData.push(nodeType);
        }
        if (nodeType.knowledge.kGroup === 'Film') {
            filmData.push(nodeType);

        }
        if (nodeType.knowledge.kGroup === 'Other') {
            otherData.push(nodeType);

        }
        if (nodeType.kGroup === 'Online Digital Media') {
            onlineDigitalMediaData.push(nodeType);
        }
    });
    if(visualPerformanceArtsData.length!==0){
    knowledgeData.push(visualPerformanceArtsData);
    }
    if(educationPublicEventsData.length!==0){
    knowledgeData.push(educationPublicEventsData);
    }
    if(nonAcademicPressData.length!==0){
    knowledgeData.push(nonAcademicPressData);
    }
    if(scientificPrintMediaData.length!==0){
    knowledgeData.push(scientificPrintMediaData);
    }
    if(broadcastMediaData.length!==0){
    knowledgeData.push(broadcastMediaData);
    }
    if(filmData.length!==0){
    knowledgeData.push(filmData);
    }
    if(otherData.length!==0){
    knowledgeData.push(otherData);
    }
    if(onlineDigitalMediaData.length!==0){
    knowledgeData.push(onlineDigitalMediaData);
    }
    displayCausalKnowledge(knowledgeData);
    }
    
$('.viewCausalSummaryButton').unbind("click").on('click', function() {
var count =1;
var ctx = document.getElementById('myChart').getContext('2d');
        $('.displayKnowledgeSummarychart').css("display","");
        var chart = new Chart(ctx, {
            // Bar chart
    exportEnabled: true,
    type: 'bar',
    data: {
      labels: [
          
          'Film', 
          'Education and Public Events', 
          'Non Academic Press',  
          'Scientific Print Media', 
          'Broadcast Media',
          'Visual and Performance Arts',
          'Other',
          'Online Digital Media'],
      datasets: [
        {
          label: "Number of supporting Articles",
          backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850","#727272","#f1595f","#599ad3"],
          data:[
              filmData.length,
              educationPublicEventsData.length,
              nonAcademicPressData.length,
              scientificPrintMediaData.length,
              broadcastMediaData.length,
              visualPerformanceArtsData.length,
              otherData.length,
              onlineDigitalMediaData.length
          ]
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'Supporting Causal Evidence'
      }
    }
    
});

//open relevant menu when bar is clicked
	document.getElementById("myChart").onclick = function(evt){
            
            var activePoints = chart.getElementsAtEvent(evt);
            var firstPoint = activePoints[0];
            var label = chart.data.labels[firstPoint._index];
            label = label.replace(/\s/g, '');
            //only expand the button once
            if(count ===1){
           $(".displayKnowledgeperNode").collapse('toggle');
//            $('.glyphicon', $(".displayKnowledgeperNode"))
//            .toggleClass('glyphicon-chevron-right')
//            .toggleClass('glyphicon-chevron-down');
                count++;
            }
            console.log("button data = ",".name"+label+"");
            $(".name"+label+"").click();
        };
     	document.getElementById("exportChart").addEventListener("click",function(){
    	var ss =chart.toBase64Image();
        window.location.href = 'data:application/octet-stream;' + ss;
    });  
});}
    }

//function that shows all Actor nodes and Edges on the graph when clicked
function drawAllActorNodes(data) {

    _.each(this.graph.getElements(), function (aNode) {
        links = graph.getConnectedLinks(aNode, [false, true]);
        if (data === 'false') {
            if (aNode.get('type') === "kb.ActorNode") {
                aNode.attr('./display', 'block');
            }
            _.each(links, function (aLinks) {
                if (aLinks.get('type') === "kb.ActorLink") {
                    aLinks.attr('./display', 'block');
                }
            });
        } else {
            if (aNode.get('type') === "kb.ActorNode") {
                aNode.attr('./display', 'none');
            }
            _.each(links, function (aLink) {
                if (aLink.get('type') === "kb.ActorLink") {
                    aLink.attr('./display', 'none');
                }
            });
        }

    });
}
//draw knowledge in a cirlce around parent nodes
function displayKnowledge(knowledgeNodes, connectedNode, knowledgeNodeId, graph) {

    var parentX;
    var parentY;
    var nodePosition;
//    var totalScore;
    var nodeRadius;
    //number of unique nodes in the graph
    var numUniqueNodes;
    var visualPerformanceArtsScore = 0;
    var visualPerformanceArtsData = [];
    var educationPublicEventsScore = 0;
    var educationPublicEventsData = [];
    var nonAcademicPressScore = 0;
    var nonAcademicPressData = [];
    var scientificPrintMediaScore = 0;
    var scientificPrintMediaData = [];
    var broadcastMediaScore = 0;
    var broadcastMediaData = [];
    var filmScore = 0;
    var filmData = [];
    var otherScore = 0;
    var otherData = [];
    var onlineDigitalMediaScore = 0;
    var onlineDigitalMediaData = [];
    

    //find the radius and current postion of the node that the kNodes will be connected to
    _.each(graph.getElements(), function (nodes) {
        if (nodes.get('databaseId') === connectedNode._id) {
            nodePosition = nodes.get('position');
            nodeRadius = (nodes.get('size').width) / 2;
            parentX = nodePosition.x;
            parentY = nodePosition.y;
        }
    });
//iterate overy every Knowledge node attached and determine how many of each node type occur 
    _.each(knowledgeNodes, function (node) {

        if (node.kGroup === 'Visual and Performance Arts') {
            visualPerformanceArtsScore = 1;
            visualPerformanceArtsData.push(node);
        }
        if (node.kGroup === 'Education and Public Events') {
            educationPublicEventsScore = 1;
            educationPublicEventsData.push(node);
        }
        if (node.kGroup === 'Non Academic Press') {
            nonAcademicPressScore = 1;
            nonAcademicPressData.push(node);
        }
        if (node.kGroup === 'Scientific Print Media') {
            scientificPrintMediaScore = 1;
            scientificPrintMediaData.push(node);
        }
        if (node.kGroup === 'Broadcast Media') {
            broadcastMediaScore = 1;
            broadcastMediaData.push(node);
        }
        if (node.kGroup === 'Film') {
            filmScore = 1;
            filmData.push(node);

        }
        if (node.kGroup === 'Other') {
            otherScore = 1;
            otherData.push(node);

        }
        if (node.kGroup === 'Online Digital Media') {
            onlineDigitalMediaScore = 1;
            onlineDigitalMediaData.push(node);
        }
    });

    //calculate the position of the knowledge nodes around the node depending on the amount of knowledge adn the 
    //type of node. i.e. rel node or normal node
    var width = (nodeRadius * 2) + 40;
    var i = 0;
    var kNodeX;
    var kNodeY;
    var coOrdinates;
    //find the number of unique nodes by adding up the scores from each data type. Possibly review this code
    numUniqueNodes = visualPerformanceArtsScore + educationPublicEventsScore + nonAcademicPressScore
            + scientificPrintMediaScore + broadcastMediaScore + filmScore + otherScore + onlineDigitalMediaScore;

    //if this type of knowledge node is present. Draw it. Calculate the position of the knowledge nodes 
    //surounding it based on the number of them. If the node it to be drawn to the left of the parent node
    //ensure that the text is on the outside
    if (visualPerformanceArtsData.length !== 0) {
        coOrdinates = getCoOrdinates(width, numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            //Possibly review how this is done. Might be a neater method.
            drawReverseKNode(visualPerformanceArtsData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(visualPerformanceArtsData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        //increment i for two reasons. 1. Keep track of number of kNofdes drawn. 2. Ensure that each kNode has a unique id
        i++;
    }
    if (educationPublicEventsData.length !== 0) {
        coOrdinates = getCoOrdinates(width, numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(educationPublicEventsData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(educationPublicEventsData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
    if (nonAcademicPressData.length !== 0) {
        coOrdinates = getCoOrdinates(width, numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(nonAcademicPressData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(nonAcademicPressData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
    if (scientificPrintMediaData.length !== 0) {
        coOrdinates = getCoOrdinates(width, numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(scientificPrintMediaData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(scientificPrintMediaData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
    if (broadcastMediaData.length !== 0) {
        coOrdinates = getCoOrdinates(width, numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(broadcastMediaData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(broadcastMediaData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
    if (filmData.length !== 0) {
        coOrdinates = getCoOrdinates(width,numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(filmData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(filmData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
    if (otherData.length !== 0) {
        coOrdinates = getCoOrdinates(width, numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(otherData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(otherData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
    if (onlineDigitalMediaData.length !== 0) {
        coOrdinates = getCoOrdinates(width,numUniqueNodes, nodeRadius, i, parentX, parentY);
        kNodeX = coOrdinates[0];
        kNodeY = coOrdinates[1];
        if (kNodeX < parentX) {
            drawReverseKNode(onlineDigitalMediaData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        } else {
            drawKNode(onlineDigitalMediaData, knowledgeNodeId, connectedNode, i, kNodeX, kNodeY);
        }
        i++;
    }
}

//draw kNode with number of evidence on the right hand side
function drawKNode(data, knowledgeNodeId, connectedNode, uniqueId, x, y) {
    numberOfEvidence = data.length;
    var knowledgeNodes = new joint.shapes.kb.Knowledge({
        position: {x: x, y: y},
        size: {width: 25, height: 25},
        attrs: {
            text: {
                fill: '#000000',
                text: numberOfEvidence,
                'letter-spacing': 0,
                style: {'text-shadow': '1px 0 1px #333333'}
            }
        },
        type: 'kb.Knowledge',
        supportingKnowledge: data,
        databaseId: '#' + knowledgeNodeId + uniqueId
    });
    iconString = iconTable[data[0]._label];
    knowledgeNodes.attr('image/xlink:href', icons[iconString]);
    knowledgeNodes.attr('./display', 'none');
    graph.addCell(knowledgeNodes);

    //draw link and add it to the graph. But make it invisible. Neccessary to find which knowledge nodes are linked to what
    sourceCellId = getCanvasIdByDatabaseId(connectedNode._id, this.graph);
    targetCellId = getCanvasIdByDatabaseId(knowledgeNodes.get('databaseId'), this.graph);
    var knowledgeLink = new joint.shapes.kb.MediaLink({
        source: {id: sourceCellId},
        target: {id: targetCellId}
    });

    knowledgeLink.attr('./display', 'none');
    graph.addCell(knowledgeLink);


}
//draw kNodes to the left of the parent node
function drawReverseKNode(data, knowledgeNodeId, connectedNode, uniqueId, x, y) {
    numberOfEvidence = data.length;
    var knowledgeNodes = new joint.shapes.kb.ReverseKnowledge({
        position: {x: x, y: y},
        size: {width: 25, height: 25},
        //label: vertexLabel,
        type: 'kb.Knowledge',
        attrs: {
            text: {
                fill: '#000000',
                text: numberOfEvidence,
                'letter-spacing': 0,
                style: {'text-shadow': '1px 0 1px #333333'}
            }
        },
        supportingKnowledge: data,
        databaseId: '#' + knowledgeNodeId + uniqueId
    });
    iconString = iconTable[data[0]._label];
    knowledgeNodes.attr('image/xlink:href', icons[iconString]);
    knowledgeNodes.attr('./display', 'none');
    graph.addCell(knowledgeNodes);

    //draw link and add it to the graph. But make it invisible. Neccessary to find which knowledge nodes are linked to what
    sourceCellId = getCanvasIdByDatabaseId(connectedNode._id, this.graph);
    targetCellId = getCanvasIdByDatabaseId(knowledgeNodes.get('databaseId'), this.graph);
    var knowledgeLink = new joint.shapes.kb.MediaLink({
        source: {id: sourceCellId},
        target: {id: targetCellId}
    });

    knowledgeLink.attr('./display', 'none');
    graph.addCell(knowledgeLink);
}

//function that gets the co ordinates for the kNodes to be placed around their parent node
function getCoOrdinates(width, length, nodeRadius, i, parentX, parentY) {
    var angle;
    var coOrdinates = [];
    var updatedRad = nodeRadius + 30;

    angle = (i / (length / 2)) * Math.PI; // Calculate the angle at which the element will be placed.
    var x = Math.round((updatedRad * Math.cos(angle)) + (width / 2)); // Calculate the x position of the element.
    var y = Math.round((updatedRad * Math.sin(angle)) + (width / 2)); // Calculate the y position of the element.

    x = x + parentX;
    y = y + parentY;
    if (nodeRadius === 10) {
        x = x - 30;
        y = y - 18;
    } else {
        x = x - 31;
        y = y - 35;
    }

    coOrdinates.push(x);
    coOrdinates.push(y);
    return coOrdinates;
}


$(".displayKnowledgeForNodeButton").click(function () {
//remove the display attribute from the knowledge div
    $(".displayKnowledgeperNode").css("display", "");
//as the user clicks the button the knowledge is toggled on adn off
    $(".displayKnowledgeperNode").collapse('toggle');
//update the glyphcion    
    $('.glyphicon', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
});

//Access each individual component of the knowledge on click i.e each of the 8 different types of knowledge
$(".displayKnowledgeperNode").on('click', "div.list-group-item", function () {
    $(".displayKnowledgeperNode").css("display", "");
    $('.glyphicon', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
});


//Access each individual component of the knowledge on click i.e each of the 8 different types of knowledge
$(".displayActorData").on('click', "div.list-group-item", function () {
    $('.glyphicon', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
});

$(".displayKnowledgeperNode").on('click', 'div.viewExtraKnowledge', function () {
    $(".hiddenKnowledge").css("display", "");
});
$(".displayNodeDataButton").click(function () {
//remove the display attribute from the knowledge div
    $(".displayNodeData").css("display", "");
//as the user clicks the button the knowledge is toggled on adn off
    $(".displayNodeData").collapse('toggle');
//update the glyphcion    
    $('.glyphicon', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
});


$(".displayActorsDataButton").click(function () {
//remove the display attribute from the knowledge div
    $(".displayActorData").css("display", "");
//as the user clicks the button the knowledge is toggled
    $(".displayActorData").collapse('toggle');
//update the glyphcion    
    $('.glyphicon', this)
            .toggleClass('glyphicon-chevron-right')
            .toggleClass('glyphicon-chevron-down');
});
 
function displayActorNodes(actorNodeData) {
    //make the button visable
    console.log(actorNodeData);
    $(".displayActorsDataButton").css('display', 'block');
    var i = 0;
    _.each(actorNodeData, function (actor) {
        var j = 1;
        var x = 0;
        $(".displayActorData").append($('<div href="#ActorItem-' + i + '" class="list-group-item" data-toggle="collapse"><i class="glyphicon glyphicon-chevron-right"></i><a href="www.someURL.de">' + actor.name + '</a>'));
        $(".displayActorData").append($('<div class="list-group collapse actorItemNumber' + i + '" style="padding-left:20px; padding-right:20px; padding-bottom:20px; background-color:white" id="ActorItem-' + i + '">'));
        $(".actorItemNumber" + i + "").append($('<span class="badge">' + j + '</span> <br>'));
        for (x in actor) {
            if (x !== "_type" && x !== "_id" && x !== "xcoord" && x !== "ycoord") {
                $(".actorItemNumber" + i + "").append($('<div class="form-group" style="padding-top:10px;"><label style="text-transform:capitalize"for="usr">&nbsp;&nbsp;' + x + '</label><textarea class="form-control" rows="auto" id="comment">' + actor[x] + '</textarea></div>'));
            }
        }
        $(".actorItemNumber" + i + "").append($('<hr/>'));//line break to diffrencaite between actors

        j++;

        i++;
    });
}

function displayNodeData(nodeData) {
    //remove the previous contents of the div
    $('.displayActorData').empty();
    //make the button visable
    $(".displayNodeDataButton").css('display', 'block');
    var x = 0;
    //append each data property to the displayer
    for (x in nodeData) {
        if (x !== "_type" && x !== "_id" && x !== "xcoord" && x !== "ycoord") {
            $(".displayNodeData").append($('<div class="form-group"><br>\n\
            <label style="text-transform:capitalize" for="usr">&nbsp;&nbsp;' + x + '</label>\n\
        <textarea class="form-control" rows="auto" id="comment">' + nodeData[x] + '</textarea></div>'));
        }
    }
 }

function displayNodeKnowledge(knowledgeData) {
    //make the button visable
    $(".displayKnowledgeForNodeButton").css('display', '');
    var i = 0;
    var j = 1;
    //for each type of data create a list group to represent it
    _.each(knowledgeData, function (knowledge) {
        var j = 1;
        var x = 0;
        $(".displayKnowledgeperNode").append($('<div href="#item-' + i + '" class="list-group-item" data-toggle="collapse">\n\
            <i class="glyphicon glyphicon-chevron-right"></i><a href="www.someURL.de">' + knowledge[0].kGroup + '</a>\n\
            <span class="badge">' + knowledge.length + '</span>'));
        
        $(".displayKnowledgeperNode").append($('<div href="#item-' + i + '.' + i + '" class="list-group collapse \n\
        knowledgeItemNumber' + i + '" style="padding-left:20px; padding-right:20px;background-color:white" id="item-' + i + '">'));
        //for each specific knowledge type render each article
        _.each(knowledge, function (k) {
            $(".knowledgeItemNumber" + i + "").append($('<span class="badge">' + j + '</span> <br>'));
            for (x in k) {
                if (x !== "_type" && x !== "_id" && x !== "xcoord" && x !== "ycoord" && x !== 'knowledgeId') {
                    if (x === 'resourceURL') {
                        $(".knowledgeItemNumber" + i + "").append($('<div class="form-group"> <label style="padding-left:10px; padding-top:20px"for="usr">Url:&nbsp;&nbsp;</label><a href="' + k[x] + '" target="_blank">Click to see webpage</a></div>'));
                    } else if (x === 'name' || x === 'description' || x === 'rating') {
                        $(".knowledgeItemNumber" + i + "").append($('<div class="form-group" style="padding-top:10px;"><label style="text-transform:capitalize" for="usr">&nbsp;&nbsp;' + x + '</label><textarea class="form-control" rows="auto" id="comment">' + k[x] + '</textarea></div>'));
                    } else {
                        $(".knowledgeItemNumber" + i + "").append($('<div class="form-group hiddenKnowledge" style="padding-top:10px;"><label style="text-transform:capitalize" for="usr">&nbsp;&nbsp;' + x + '</label><textarea class="form-control" rows="auto" id="comment">' + k[x] + '</textarea></div>'));
                    }}
            }
            //line break to differentcaite between articles
            $(".knowledgeItemNumber" + i + "").append('<hr/>');
            j++;
        });
        i++;
    });
}

//appedn Causal knowledeg into the knowledge viewer on the right hand side
function displayCausalKnowledge(causalData) {
    
    //remove the previous contents of the div
    $('.displayKnowledgeperNode').empty();
    //make the button visable
    $(".displayKnowledgeForNodeButton").css('display', '');
    
    $('.displayActorData').empty();
    //make the button visable
    $(".displayActorsDataButton").css('display', 'none');
    
     $('.displayNodeData').empty();
    //make the button visable
    $(".displayNodeDataButton").css('display', 'none');

    var i = 0;
    var j = 1;
    //for each type of data create a list group to represent it
    _.each(causalData, function (knowledge) {
        var j = 1;
        var x = 0;
        var count = 1;
        var className = knowledge[0].knowledge.kGroup;
        className = className.replace(/\s/g, '');
        $(".displayKnowledgeperNode").append($('<div href="#item-' + i + '" class="list-group-item name'+ className+'" data-toggle="collapse"><i class="glyphicon glyphicon-chevron-right"></i><a href="www.someURL.de">' + knowledge[0].knowledge.kGroup + '</a><span class="badge">' + knowledge.length + '</span>'));
        $(".displayKnowledgeperNode").append($('<div href="#item-' + i + '.' + i + '" class="list-group collapse knowledgeItemNumber' + i + '" style="padding-left:20px; padding-right:20px;background-color:white" id="item-' + i + '">'));

        _.each(knowledge, function (k) {
            $(".knowledgeItemNumber" + i + "").append($('<span class="badge">' + j + '</span> <br>'));
            for (x in k.knowledge) {
                if (x !== "_type" && x !== "_id" && x !== "xcoord" && x !== "ycoord" && x !== 'knowledgeId') {
                    if (x === 'resourceURL') {
                        $(".knowledgeItemNumber" + i + "").append($('<div class="form-group"> <label style="padding-left:10px; padding-top:20px"for="usr">Url:&nbsp;&nbsp;</label><a href="' + k.knowledge[x] + '" target="_blank">Click to see webpage</a></div>'));
                    } else if (x === 'className' || x === 'description' || x === 'rating') {
                        $(".knowledgeItemNumber" + i + "").append($('<div class="form-group" style="padding-top:10px;"><label style="text-transform:capitalize" for="usr">&nbsp;&nbsp;' + x + '</label><textarea class="form-control" rows="auto" id="comment">' + k.knowledge[x] + '</textarea></div>'));
                    } else {
                        $(".knowledgeItemNumber" + i + "").append($('<div class="form-group hiddenKnowledge" style="padding-top:10px;"><label style="text-transform:capitalize" for="usr">&nbsp;&nbsp;' + x + '</label><textarea class="form-control" rows="auto" id="comment">' + k.knowledge[x] + '</textarea></div>'));                       
                    }
                }
                count++;
            }
            $(".knowledgeItemNumber" + i + "").append($('<div class="form-group" style="padding-top:10px;"><label style="text-transform:capitalize" for="usr">&nbsp;&nbsp;Relevance</label><textarea class="form-control" rows="auto" id="comment">' + k.relevance + '</textarea></div>'));
            $(".knowledgeItemNumber" + i + "").append('<hr/>');//line break to diffrencaite between articles

            j++;
        });
        i++;
    });
     $(".viewCausalSummaryButton").css('display', '');
}